\documentclass{article}
\usepackage{fullpage}

\begin{document}
\noindent{\Large{DIRECTIONS FOR USING LINGUAVIEW}}\\

LinguaView currently has two components.

\begin{enumerate}
\item Tracing. Automatic tracing, the ability to correct the autotracings, head correction, and putting the files for each item together in a .csv file. Head correction.

\item View results. Linguagram, linguagram-with-neutral-subtraction, waveform, spectrogram, sound, and the ability to set boundaries and label sections.
\end{enumerate}

Instructions on how to work with each component follow.\\

{\bf VERY IMPORTANT NOTE: put each word in a different folder in each subject folder. When you trace, it overwrites all previous traces in the folder, so having all the words in one folder means that you run a high risk of erasing traces you've already done.}

NOTE TO DA: ADD DATA STRUCTURE IMAGE!

\noindent {\bf TRACING}

\begin{description}

\item {OPEN AUTOTRACE.} AutoTrace is on the desktop. Double-click on it. Finder window pops up. Select AutoTrace.py. AutoTrace window should pop up.

\item{FIND IMAGE FILES TO TRACE.}  (This assumes image files have been selected already from iMovie.) Click Open and it brings up a file chooser -- browse to find the images you want to trace. Select the directory you want to work with and select all files (see note 1 below). Hit Open on file chooser. This returns you to the AutoTrace window with a list of files to examine.\\

Note 1: you cannot trace only some of the files in a directory. It will trace all files in the directory even if you select only a subset of the files. (This may get fixed later.)

Note 2: if it detects images are the wrong size, it will tell you it is going to resize the images. Click OK, and it will resize the images. When the progress bar gets to the end, you have to close it. (It doesn't automatically close and it doesn't prompt you to close it.)

\item{AUTOTRACE FILES.} Click Autotrace button in AutoTrace. Hit OK. (At this point, it opens MatLab and this can take a minute or two.) A MatLab window pops up and you can watch it trace.  When the "it's done" window pops up, click "close".

\item{REVIEW RESULTS.} Hit View in the AutoTrace window. A window pops up with the first file on the list. The window title tells you which image you are looking at. You must review every image before you create a Linguagram, else the number of data points in viewed and unviewed images differs, and the linguagram looks goofy.

\item{SCROLL THROUGH IMAGES.} Use arrows or the next/previous button. It automatically saves the trace when you switch to another image (by using arrows or next/previous). CAUTION: If you hit the up-arrow key, the keys stop working (the next/previous still works). You have to start over to get the keys working.

\item{CORRECT A TRACE.} Use the pen to correct it. You don't need to do anything other than draw with the pen. Closing or switching to another image saves the corrections. (For APIL Lab: If you want to erase some points (e.g. because the data is unclear), hold down the button on the pen and hover over the offending points. They will disappear.

\item{CHANGE THE GRID (FAN).} Click on Set Grid button. This will erase the grid (fan) that is there. Now draw two new lines that define the edges of the grid that you want to use: click on one end of the line and (holding it down) drag to the other end of that line. Repeat for the right side. This grid will appear on all subsequent images. (In APIL, we probably won't use this because the default grid fits our machine's image.)

\item{DO HEAD CORRECTION.} (tba)

\item{SAVE TRACES IN A VIEWABLE FORMAT.} Close the tracing window. Hit Export button. This brings up a box for choosing the export location. Include head correction if there is head correction. Can click View Results box to open a window for viewing the results. Hit OK. This puts files where you told it to put them out.

\item{FILES RESULTING FROM EXPORT FUNCTION.} 1. Palatoglossatron output (all information about traces and dots/head correction (if you have any). 2. .csv files for each word (.csv files may include a set of files if the word has more than one file associated with it).

\end{description}

{~}

\noindent {\bf VIEW RESULTS}

\begin{description}

\item{OPEN LINGUAVIEW FROM TRACING FUNCTION.} A window pops up listing all the .csv files made. Select THE ONESyou want to view. Click options at the bottom to show what you want to look at: Linguagram, Waveform, Neutral Contours, Spectrogram. NOTE: these are only functional if the appropriate files (neutral.csv and .wav) are in the directory.)

\item{OPEN LINGUAVIEW FROM TERMINAL WINDOW.} Once you have used Finder to get into the LinguaView directory (see above),  python Li -- autofiller will fill in LinguaView and you need to add .py . Hit Enter and the LinguaView window opens.

\item{MANIPULATE LINGUAGRAM IMAGE.} You can enlarge or turn the file by click-and-drag.

\item{SELECT A BOUNDARY.} In Label, left-click on any of the images to make a boundary. You can make up to 99 boundaries in one image.  

\item{DELETE A BOUNDARY.} In Label, right-click on the red line.

\item{MOVE A BOUNDARY.} Left-click-and-drag the boundary.

\item{LABEL AN INTERVAL.} Click on an interval separated by boundaries in the topmost box. Type a label into the text entry bar (above images and below buttons). At this point, we cannot save labels, so use the Mac tool to grab it and save a .pdf if you need it for a presentation!

\item{PLAY SOUND.} Click the button.

\item{NEUTRAL TONGUE.} If there is a neutral.csv file for the word, it shows the adjusted linguagram. (Note: you can show both adjusted and raw linguagrams simultaneously.)

\item{CREATE A NEUTRAL .CSV.} Identify the frames which will be averaged for the neutral tongue position. Name each one neutral; the program will add frame numbers to the file name. AutoTrace creates the neutral.csv file which in turn is used by the neutral tongue function in LinguaView.

\end{description}

{~}

\noindent {\bf CREATE TRAIN NETWORK DATA FILES}\\

TrainNetwork allows you to take corrected traces and add them to the network training, then retrain and get improved traces for the remainder of your data. At this point, we recommend adding 300 traces before retraining. It takes about 3-4 hours to train (or retrain).\\

First step is getting the data into the right format. Second step is to actually train the network.

\noindent {\bf TRAINING DATA}\\

\begin{description}

\item{SETTING UP TRAINING DATA.} Before opening TrainNetwork, create a separate folder where training data is stashed. Currently, training data is in UltraSpeech/Data. Add the new data you want to incorporate in the training (don't duplicate file names!). 

\item{TRAINING DATA FOLDER STRUCTURE.} Each Training Data Subject$\%$ directory must contain two parts, (i) TongueContours.csv and (ii) a directory called JPG, which contains all the ultrasound images you want to use. Names of ultrasound images are word\_$\#\#\#\#\#\#$ where the numbers identify the frame number. TongueContours.csv is the output of Palataglossatron, containing traces for each image in the JPG directory. You can do this with LinguaView's export function, and then rename the Palataglossatron\_output.txt file to TongueContours.csv. \\ 

Note that there should be no subdirectories within the Subject JPG folder, so you may need to move files.\\ 

If you take images out of the JPG folder, then open TongueContours.csv with Excel and remove the corresponding lines. THIS IS IMPORTANT.\\ 

Only the data in this folder will be used for training so if you take anything out, it won't be involved in training. NOTE: We need to think about how to name files so this all works.\\ 

In the UltraSpeech/Data/Subject$\#$ folder, here's how things match up: Subject1 and Subject2 are pa-ta-ka; Subject 4-18 are English [l]s, Subject19 is Georgian, Subject20 is French. 	
\end{description}

\noindent {\bf TRAIN NETWORK}\\

\begin{description}
	\item {OPEN AUTOTRACE.} Double-click on AutoTrace on the desktop to get the Finder window. Double-click on TrainNetwork.py. Train Network window should be open (along with a couple of terminal windows that you can close.)
	
	\item{SPECIFY TRAINING DATA.} Click Data, and it gives the Specify Training Data option. Click that and it opens a file chooser. Find the data folder you want. Select the subjects you want to use for training. 
	
	\item{SPECIFY TRAINING OPTIONS.} Select Ultrasound and Contours for training and Ultrasound for run (currently no other options are available). Click GO. It will start printing stuff in a window on the bottom. Leave it overnight.
	
	\item {FIND \& MOVE NETWORK.MAT FILE.} It will be in ~/AutoTracer/Trunk/TrainNetwork/savefiles/network.mat. Move it to Desktop/AutoTrace/savefiles folder. (This will get fixed.)
	
	\item{RENAME RESULTS.} When it is finished, it will no longer be printing stuff in the window. (Use Activity Monitor on Mac to see if it is still running -- lots of green.) Close the window. You can check the new file in /AutoTrace/SaveFiles -- there should be a new Network.mat file. Rename this file to network041510.mat. Also save it with the date you ran it and notes about what you added. We need to discuss this.
	
	\item{EFFECT OF RETRAINING.} Currently, next time you run AutoTrace it will use the newly trained network.\\
	
	
NOTE: Currently, training on ultrasound and contours and running on ultrasound are the only options available. Stay tuned...\\ \\

NOTE: when more options are available, it will still only be possible to provide the run data that was selected in the training. At this point, the experimenter needs to remember what is available. Later we hope to have only the available options (based on training) show up for autotracing.

\end{description}

{~}


\noindent {\bf CAPTURING DATA}

\begin{description}

	\item {PLUG IN DEVICE.} Use firewark 4-pin-to-9-pin connector to connect the Sony DV Recorder to the MacPro. Turn it on.
	
	\item {OPEN iMOVIE.} Go to Dock or Applications to find iMovie. Open iMovie.
	
	\item {IMPORT DATA.} Go to File and select Import from camera. Check the lower lefthand corner to make sure that Manual is checked, not Automatic. Using the directional buttons, cue up the tape to where you want it. In the lower right hand corner, click Import. Select ``Create a new Event''. Give the file a name. Click Import. Importing takes place in real time so be patient!
	
	\item{STOP IMPORTING.} Click stop button on controls, then click done. 
	
\end{description}

\noindent {\bf SELECTING ITEMS AND CREATING STILLS}

\begin{description}
	\item {SELECT UTTERANCES.} Bring mouse down to lower half of screen where the movie is ``spread out''. A red line will appear. As you scroll over the movie, you can also hear the speaker. Left-click to set the marker; scroll further to the right to find the end of the selection you want (using the sound as the clue). Left-click again. Right-click on the selection and choose copy. Click window at top left and hit command-V to copy the selection. 
	
	\item {CHECK FOR CROPPING.} If the top edge of the ultrasound background does not show in the large image in the top right corner, then the image has been cropped and we don't want that. Put mouse over clip on left; blue box with a gear shows up and click that box. Select cropping and rotation. Hit ``fit'' and then hit ``done''. Notice that your clip location is marked in the ``spread out'' movie. This is useful for identifying the next selection!!
	
	\item {SPLIT IMAGE INTO STILLS.} Click an image, click Share (top tool bar), select Export using QuickTime. Name file as Word$\#$\_ (where ``Word'' is the item pronounced). In QuickTime box, click the blue arrow at the right edge of the Export line. Of the options given, select Movie to Image Sequence. Click Options button: change Format to JPEG and unclick ``insert space before number'' and set ``frames per second'' as Best. Click Options button: select Best Quality; click ok. When you are back to the first screen, select where the file will go. Save. (You don't have to do all the screens everytime -- once you see that the system has saved the selections, you can go directly to saving.)
	
	\item {TO SAVE SOUND WITH IMAGE.}  After saving, you go back to the main screen, click Share (top tool bar), select Export using QuickTime. In QuickTime box, select Sound to Wave. Give it a name that is consistent with the image files. Save.
	
	\item {DELETE OLD FILE.} Identify next clip and save. Before extracting stills from the second clip, delete the first one. Otherwise, both will save together. However, if you delete the original clip before identifying the next one, you lose your place holder in the video stream!
		
	\item{FOR APIL PROJECTS.} For each study, have a folder with the study name (e.g.\ Gaelic). Each StudyName includes subject directories named StudyNameS$\#$, e.g.\ GaelicS1. Each subject directory will have utterance files and .wav files.
	
\end{description}




TO DO:

\begin{itemize}
\item fix error in line 153 where LinguaView looks for file.clean instead of file.wav. Also in finding the neutral contour.
\item automatic destination for results of network training.

\item Integrate head correction and write up directions.
\item Set up to draw Gick-style figures. 
\item Integrate frame selection with labeling boundaries in LinguaView in order to identify crucial subparts of the traced file.

\end{itemize}
\end{document}

\begin{description}

	\item
	
\end{description}

